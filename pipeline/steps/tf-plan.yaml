parameters:
  - name: subscription
    type: string

  - name: environment
    type: string

  - name: resourceGroup
    type: string

  - name: builtFrom
    type: string
    default: ''

  - name: product
    type: string
    default: ''

  - name: outputLocation
    type: string

steps:

  - task: TerraformCLI@0
    displayName: Terraform plan
    inputs:
      command: plan
      workingDirectory: $(System.DefaultWorkingDirectory)/terraform
      environmentServiceName: ${{ parameters.subscription }}
      commandOptions: >
        -var-file="../../../environments/${{ parameters.environment }}.tfvars"
        -var-file="../../../environments/shared.tfvars"
        -out="${{ parameters.outputLocation }}"
        -var "resource_group=${{ parameters.resourceGroup }}"
        -var "environment=${{ parameters.environment }}"
        -var "la_nonprod_sub_id=$(la-nonprod-sub-id)"
        -var "la_prod_sub_id=$(la-prod-sub-id)"
        -var "la_sbox_sub_id=$(la-sbox-sub-id)"
        -var "builtFrom=${{ parameters.builtFrom }} "
        -var "product=${{ parameters.product }}"
